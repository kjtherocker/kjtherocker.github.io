<!doctype html>
<html lang="en">
    <head>
        <title>Kyle Johnson - Portfolio</title>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Bootstrap Integration -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

        <!-- Bootstrap Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

        <!-- Highlight JS code block highlighting -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/stackoverflow-dark.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>

        <!-- Custom CSS -->
        <style>
            .hover-action {
                cursor: pointer;
                transition: 0.5s ease;
                height: 300px;
                margin-bottom: 0 !important;
            }

            .hover-action:hover {
                -webkit-transform: scale(0.95);
                -ms-transform: scale(0.95);
                transform: scale(0.95);
                transition: 0.5s ease;
            }
        </style>
    </head>
    <body>

        <!-- Navigation Bar -->
        <nav class="navbar fixed-top navbar-dark bg-dark navbar-expand-lg" style="background-color: rgba(0, 0, 0, .85) !important; -webkit-backdrop-filter: saturate(180%) blur(20px) !important; backdrop-filter: saturate(180%) blur(20px) !important;">
            <div class="container">
                <!-- Home -->
                <a class="navbar-brand d-flex align-items-center" href="index.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-joystick me-2" viewBox="0 0 16 16">
                    <path d="M10 2a2 2 0 0 1-1.5 1.937v5.087c.863.083 1.5.377 1.5.726 0 .414-.895.75-2 .75s-2-.336-2-.75c0-.35.637-.643 1.5-.726V3.937A2 2 0 1 1 10 2z"/>
                    <path d="M0 9.665v1.717a1 1 0 0 0 .553.894l6.553 3.277a2 2 0 0 0 1.788 0l6.553-3.277a1 1 0 0 0 .553-.894V9.665c0-.1-.06-.19-.152-.23L9.5 6.715v.993l5.227 2.178a.125.125 0 0 1 .001.23l-5.94 2.546a2 2 0 0 1-1.576 0l-5.94-2.546a.125.125 0 0 1 .001-.23L6.5 7.708l-.013-.988L.152 9.435a.25.25 0 0 0-.152.23z"/>
                    </svg>
                    <strong>Kyle Johnson</strong>
                </a>

                <!-- Mobile Support -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Menu Items -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/portfolio.html">Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/resume.html">Resume</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/workExp.html">Work Experience</a>
                    </li>
                    </ul>
                </div>
            </div>
        </nav><br/><br/><br/>

        <div class="container mt-5 mb-5">
            <!-- Header and Source Buttons -->
            <div class="row">
			<table>
				<tr>
					<th>                
						<div class="col-lg-6">
						<img style="width: 40%; "src="../Images/AtlantisTitle.png">
						<h6 style="color: #727272;">Personal Project, Unreal, C++, Only Developer</h6>
						</div>
					</th>
				</tr>
				<tr>
					<td>
					<div class="col-lg-12">
		                <a href="https://github.com/kjtherocker/DescentIntoAtlantis" class="btn btn-dark float-end mt-3 ms-2"><i class="bi bi-github me-1"></i> Source Code</a>
					</div>
					<div class="col-lg-12">
					    <a href="https://drive.google.com/file/d/1S6DsYQtue8CFd6RQezQ5Ytq575CR99Mo/view?usp=share_link" class="btn btn-dark float-end mt-3 ms-2"><i class="bi bi-github me-1"></i> Build Files</a>
					</div>
					</td>
					<td>

					</td>
	
				</tr>
				
				
				

				
				</table>
            </div>

            <!-- Description of Project -->
            <div class="row mt-2 gx-5 gy-5">
                <div class="col-lg-6">
					<iframe style="width: 100%; height: 38vh;" src="https://www.youtube.com/embed/UP2dnRrAeUg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="col-lg-6">
                    <strong>Descent Into Atlantis</strong> is a Turn Based Dungeon Crawler. Similar to the Likes of Labryinth of Refrain, Etrian Odyssey and Mary Skelter. 
                </div>                
            </div>

            <!-- Source Code -->
            <div class="row mt-4 gx-5 gy-5">
                <div class="col-lg-3">
                    <h3 class="mt-3">Combat System</h3> 
                    <p><strong>Descent Into Atlantis</strong>  uses a variation of the press turn system popularised by Shin Megami Tensei Nocturne. Hitting the enemy's weakness will give you more turns but hitting the enemys strength will make you lose your turns. The combat moves in a much more fervent pace and was a great choice to create engaging combat.</p>
                </div>
                <div class="col-lg-9">
                    <pre>
                        <code class="language-cs" style="width: 100%; height: 50vh;">
// This is called after we have already selected a skill

void UPressTurnManager::ActivateSkill(UCombatEntity* aAttacker, int aCursorPosition, USkillBase* aSkill)
{

	TArray<UCombatEntity*>  enemyInCombat    = TArray<UCombatEntity*>(combatManager->GetEnemysInCombat());
	TArray<UCombatEntity*>  playersInCombat  = TArray<UCombatEntity*>(combatManager->GetPlayersInCombat());
	
	TArray<UCombatEntity*> entitySkillsAreUsedOn;

	TArray<PressTurnReactions> turnReactions;

	FSkillsData skillsData = aSkill->skillData;
	
	if(aAttacker->characterType == ECharactertype::Ally)
	{
		entitySkillsAreUsedOn = skillsData.skillUsage == ESkillUsage::Opponents ? enemyInCombat : playersInCombat;
	}
	else if(aAttacker->characterType == ECharactertype::Enemy)
	{
		entitySkillsAreUsedOn = skillsData.skillUsage == ESkillUsage::Opponents ? playersInCombat : enemyInCombat;
	}
	
	if(skillsData.skillRange == ESkillRange::Single)
	{
		turnReactions.Add(aSkill->UseSkill(aAttacker,entitySkillsAreUsedOn[aCursorPosition]));
	}
	else if (skillsData.skillRange == ESkillRange::Multi)
	{
		for(int i = 0 ; i < entitySkillsAreUsedOn.Num();i++)
		{
		
			turnReactions.Add(aSkill->UseSkill(aAttacker,entitySkillsAreUsedOn[i]));
			
		}
		
	}

	ProcessTurn(turnReactions);
}

-----------------------------------------------------------------------------------------

void UPressTurnManager::ProcessTurn(TArray<PressTurnReactions> aAllTurnReactions)
{
	//Null Skills Consume all press turns completely

	for (PressTurnReactions reaction : aAllTurnReactions)
	{
		if (reaction == PressTurnReactions::Null)
		{
			ConsumeTurn(activePressTurns.Num());
			return;
		}
	}
        
        
	//If Dodged Consume two press turns if empowered only take the empowered and the next token
        
	for (PressTurnReactions reaction : aAllTurnReactions)
	{
		if (reaction == PressTurnReactions::Dodge ||
			reaction == PressTurnReactions::Strong )
		{
			ConsumeTurn(2);
			return;
		}
	}
        
	//If weakness is hit correctly then the turn that was used will be empowered
        
	for (PressTurnReactions reaction : aAllTurnReactions)
	{
		if (reaction == PressTurnReactions::Weak || 
			reaction == PressTurnReactions::Pass)
		{
			EmpowerTurn();
			return;
		}
	}
        
        
	//Normal action Consume 1 empowered or normal pressturn
	ConsumeTurn(1);
	//Passing will turn a whole icon into a empowered one but will consume an empowered one if it is

}
---------------------------------------------------------------------------------------------

void UPressTurnManager::ConsumeTurn(int aAmountOfTurnsConsumed)
{
	
	int TurnsRemaining =  (activePressTurns.Num() - 1)  - aAmountOfTurnsConsumed;
	
	for (int i = activePressTurns.Num() - 1; i > TurnsRemaining; i--)
	{
		if(i >= 0)
		{
			inActivePressTurns.Add(activePressTurns[i]);
			activePressTurns.RemoveAt(i);
		}
	}
	turnCounter->SetTurnOrder(activePressTurns.Num(),characterType);
	
	combatManager->TurnFinished();
}
    
-------------------------------------------------------------------------------------------


void UPressTurnManager::EmpowerTurn()
{
	int ActivePositionTurn = activePressTurns.Num() - 1;
        
	if (activePressTurns[ActivePositionTurn]->isEmpowered == false)
	{
		activePressTurns[ActivePositionTurn]->isEmpowered = true;
		turnCounter->SetEmpowerTurnIcon(ActivePositionTurn);
		combatManager->TurnFinished();
	}
	else
	{
		ConsumeTurn(1);
	}
}
                        </code>
                    </pre>
                </div>
            </div>

            <!-- Source Code -->
            <div class="row mt-2 gx-5 gy-5">
                <div class="col-lg-9">
                    <pre>
                        <code class="language-cs" style="width: 100%; height: 50vh;">
    skillFactory = NewObject<USkillFactory>();
    
    skillFactory->InitializeDatabase(dataTablesSkills);

    if(dataTables.Contains(EDataTableTypes::Enemys) &&
       dataTables.Contains(EDataTableTypes::EnemyGroups))
    {
        if(dataTables[EDataTableTypes::Enemys] != nullptr
            && dataTables[EDataTableTypes::EnemyGroups] != nullptr)
        {
            enemyFactory = NewObject<UEnemyFactory>();
            enemyFactory->InitializeDatabase(dataTables[EDataTableTypes::Enemys],
                dataTables[EDataTableTypes::EnemyGroups]);
        }
    }

    combatManager = NewObject<UCombatManager>();
    combatManager->Initialize(this,world);

    if(dataTables.Contains(EDataTableTypes::Party) &&
       !dataTablesClasses.IsEmpty())
    {
        if(dataTables[EDataTableTypes::Party] != nullptr)
        {
            partyManager = NewObject<UPartyManager>();
            partyManager->InitializeDataTable(skillFactory,dataTables[EDataTableTypes::Party], dataTablesClasses,combatManager);
        }
    }

    if(dataTables.Contains(EDataTableTypes::Tutorial))
    {
        if(dataTables[EDataTableTypes::Tutorial] != nullptr)
        {
            tutorialManager = NewObject<UTutorialManager>();
            tutorialManager->InitializeDatabase(dataTables[EDataTableTypes::Tutorial]);
        }
    }
    if(dataTables.Contains(EDataTableTypes::Floor)
        && dataTables.Contains(EDataTableTypes::FloorEvent))
    {
        if(dataTables[EDataTableTypes::Floor] != nullptr
            &&dataTables[EDataTableTypes::FloorEvent] != nullptr)
        {
            floorFactory = NewObject<UFloorFactory>();
            floorFactory->InitializeDatabase(dataTables[EDataTableTypes::Floor],dataTables[EDataTableTypes::FloorEvent]);
            floorEventManager = NewObject<UFloorEventManager>();
            floorEventManager->Initialize( this,floorFactory,combatManager);
        }
    }

    if(dataTables.Contains(EDataTableTypes::Dialogue))
    {
        if(dataTables[EDataTableTypes::Dialogue] != nullptr)
        {
            dialogueFactory = NewObject<UDialogueFactory>();
            dialogueFactory->InitializeDatabase(dataTables[EDataTableTypes::Dialogue]);
        }
    }

-----------------------------------------------------------------------------------------

void UFloorFactory::InitializeDatabase(UDataTable* aFloorDatabase,UDataTable* aFloorEnemyDatabase)
{
	UDataTable* datatable = aFloorDatabase;
	for(int i = 0 ; i < datatable->GetRowMap().Num(); i ++)
	{
		floorData.Add(*datatable->FindRow<FFloorData>(FName(FString::FromInt(i)),FString("Searching for Floors"),true));

		UFloorBase* floorBase = NewObject<UFloorBase>();
		floorBase->floorData = floorData[i];
		
		floorDictionary.Add(floorData[i].floorIdentifier,floorBase);
	}

	UDataTable* datatable2 = aFloorEnemyDatabase;
	for(int i = 0 ; i < datatable2->GetRowMap().Num(); i ++)
	{
		floorEnemyData.Add(*datatable2->FindRow<FFloorEventData>(FName(FString::FromInt(i)),FString("Searching for Floors Events"),true));
	}

	for(int i = 0 ; i < floorEnemyData.Num(); i++)
	{
		floorDictionary[floorEnemyData[i].floorIdentifier]->floorEventData.Add(floorEnemyData[i].positionInGrid,floorEnemyData[i]);
	}
}
-----------------------------------------------------------------------------------------

void UPartyManager::InitializeDataTable (USkillFactory* aSkillFactory,UDataTable* aDataTable, TMap<EDataTableClasses,UDataTable*> aClassDataTable,UCombatManager* aCombatManager)
{
	skillFactory = aSkillFactory;

	UDataTable* datatable = aDataTable;
	for(int i = 0 ; i < datatable->GetRowMap().Num(); i ++)
	{
		playerEntityData.Add(*datatable->FindRow<FPlayerEntityData>(FName(FString::FromInt(i)),FString("Searching for seres"),true));
	}

	
	for(int i = 0;i < playerEntityData.Num();i++)
	{
		//if we dont get back the correct information from the datatable
		EDataTableClasses classTable = playerEntityData[i].DataTableClass;
		UPlayerCombatEntity* PlayerCombatEntity = NewObject<UPlayerCombatEntity>();

		PlayerCombatEntity->SetPlayerEntity(playerEntityData[i]);
		PlayerCombatEntity->SetTacticsEntity(aSkillFactory);
		PlayerCombatEntity->SetPlayerClass(aClassDataTable[classTable]);
		PlayerCombatEntity->SetTacticsEvents(aCombatManager);
		

		playerCombatEntity.Add(PlayerCombatEntity);
		playerCombatEntityInfo.Add(classTable,PlayerCombatEntity);
	}
}
                        </code>
                    </pre>
                </div>
                <div class="col-lg-3">
                    <h3 class="mt-3">Data Driven Design</h3> 
                    <p>All aspects of the game's design from the enemies, to the dialogue, floor, and tutorials are all data driven. if you want to see how I setup the data <a href="https://docs.google.com/spreadsheets/d/1mNT7-p1rU0Dz-9B6zCIoxLS0xFT0H42AjDRI9GV0-Hc/edit?usp=sharing">click here</a></p>
                </div>
            </div>
			
			            <!-- Source Code -->
            <div class="row mt-4 gx-5 gy-5">
                <div class="col-lg-3">
                    <h3 class="mt-3">Dungeon Construction</h3> 
                    <p><strong>Descent Into Atlantis</strong> is constructed using information set in a DataTable. Each node of the floor tells us which cardinal direction is currently free. Then leaves that wall open during the generation process </p>
                </div>
                <div class="col-lg-9">
                    <pre>
                        <code class="language-cs" style="width: 100%; height: 50vh;">
						
						
						

void AFloorManager::Initialize(ADesentIntoAtlantisGameModeBase* aGameModeBase)
{
	cardinalPositions.Add(ECardinalNodeDirections::Up,    FVector2D(-1,0));
	cardinalPositions.Add(ECardinalNodeDirections::Down,  FVector2D(1,0));
	cardinalPositions.Add(ECardinalNodeDirections::Left,  FVector2D(0,-1));
	cardinalPositions.Add(ECardinalNodeDirections::Right, FVector2D(0,1));
	gameModeBase = aGameModeBase;
}

-----------------------------------------------------------------------------------------
//Floor base is created and set by Data in a DataTable
void AFloorManager::SpawnFloor(UFloorBase* aFloorBase)
{
	if(aFloorBase == nullptr)
	{
		return;
	}

	aFloorBase->Initialize();

	AFloorNode* Object = nullptr;
	int AmountOfFloorNodes = aFloorBase->GridDimensionX * aFloorBase->GridDimensionY;

	floorNodes.Init(Object,AmountOfFloorNodes);
	currentFloor = aFloorBase;

	CreateGrid(aFloorBase);
	SetFloorNodeNeightbors(floorNodes);
	
}
-----------------------------------------------------------------------------------------

void AFloorManager::CreateGrid(UFloorBase* aFloor)
{
	UFloorBase* tempfloor = aFloor;
	for (int x = 0; x < tempfloor->GridDimensionX; x++)
	{
		for (int y = 0; y < tempfloor->GridDimensionY; y++)
		{
			int LevelIndex = aFloor->GetIndex(x, y);
			//If there is no node then continue
			if (tempfloor->floorData.floorBlueprint[LevelIndex] == (short)ECardinalNodeDirections::Empty)
			{
				continue;
			}

			SpawnFloorNode(x , y,LevelIndex );
			floorNodes[LevelIndex]->SetWalkableDirections(aFloor->floorData.floorBlueprint[LevelIndex]);
			FVector2D positionInGrid = FVector2D(x,y);
			if(aFloor->floorEventData.Contains(positionInGrid))
			{
				floorNodes[LevelIndex]->hasFloorEvent = true;
				floorNodes[LevelIndex]->floorEventHasBeenTriggeredEvent = gameModeBase->floorEventManager->EventHasBeenTriggered;
				SpawnFloorEnemyPawn(positionInGrid);
			}
		}
	}
	

}

---------------------------------------------------------------------------------------------

void AFloorManager::CreateFloor(EFloorIdentifier aFloorIdentifier)
{
	floorDictionary = gameModeBase->floorFactory->floorDictionary;
	
	if(floorDictionary[aFloorIdentifier] != nullptr)
	{
		SpawnFloor(floorDictionary[aFloorIdentifier]);
		SetPlayerPosition(floorDictionary[aFloorIdentifier]->floorData.startPosition);
	}
	
}

    
-------------------------------------------------------------------------------------------


void AFloorManager::SpawnFloorNode(int aRow, int aColumn, int aIndex)
{
	//Setting new Positon
	FVector PositionOffset;
	PositionOffset.Set(200 * aRow, 200 * aColumn, 0);
	FVector ActorFinalSpawnPoint = GetActorLocation() + PositionOffset ;
	
	FVector2D PositionInGrid;
	PositionInGrid.Set(aRow,aColumn);
	
	//Rotation
	FRotator rotator = GetActorRotation();
	
	//Spawn
	AFloorNode* floorNode;


	floorNode = Cast<AFloorNode>(GetWorld()->SpawnActor<AActor>(floorNodeReference, ActorFinalSpawnPoint, rotator));
	floorNode->SetPositionInGrid(PositionInGrid);

	floorNodes[aIndex] = floorNode;
}
-------------------------------------------------------------------------------------------
void AFloorManager::SetFloorNodeNeightbors(TArray<AFloorNode*> aFloorNodes)
{
	if(aFloorNodes.Num() == 0)
	{
		return;
	}

	for(int i = 0 ; i < aFloorNodes.Num();i++)
	{
		AFloorNode* mainNode = aFloorNodes[i];

		// In situations where the node was removed at creation
		if(mainNode != nullptr)
		{
			TArray<ECardinalNodeDirections> walkableDirections = mainNode->walkableDirections;
		
			for (ECardinalNodeDirections direction : walkableDirections)
			{
				AFloorNode* neightborNode = GetNodeInDirection(mainNode->positionInGrid, direction);

				//In situations where the neightbor in that direction doesnt exist
				if(neightborNode != nullptr)
				{
					mainNode->nodeNeighbors.Add(direction,neightborNode);
				}
			}
		}
	}
}

                        </code>
                    </pre>
                </div>
            </div>
			
			
				 <p>
	 </p>
	 

            <!-- Gallery -->
            <h3>Gallery</h3>
            <br/>
            <div class="row gx-5 gy-5">
                <div class="col-lg-4">
                    <img style="width: 100%; "src="../Images/Atlantis_Pic_1.png">
                </div>
                <div class="col-lg-4">
                    <img style="width: 100%; "src="../Images/Atlantis_Pic_2.png">
                </div>
                <div class="col-lg-4">
                    <img style="width: 100%; "src="../Images/Atlantis_Pic_3.png">
                </div>
            </div>
        </div>
    </body>
</html>
